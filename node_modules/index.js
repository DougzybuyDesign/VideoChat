// This the dependency setup for the video chat appplication

const app = require ("express")();
const server = require ("http").createServer(app);
const  cors = require ("cors");
const io = require ("socket.io")(server,{
  cors:{
origin:"*",
method:["GET", "POST"]
  }

  
});
app.use((cors));

const PORT = process.env.PORT||5000; // this is the port selection if not found defaults to port 5000
// this is the first route
app.get ((req,res)=>{
res.send('Server is running')
});
server.listen(PORT,() => console.log`Server listening on port ${PORT}`);
// backend server io code
io.on ('connection', (socket) => {
socket.broadcast.emit("me", socket.id);
socket.on('disconnect',()=>{
socket.broadcast.emit("callended");
});
socket.on ("calluser",({ userToCall, signalData, from,name}) =>{
io.to("userToCall").emit("calluser",{signal:signalData,from,name});
});
socket.on("answer call",(data) =>{
  io.to(data.to).emit ("call accepted",data.signal);
})
});
//complete server side code for the application